%html
  %head
    %title
      Xunit Test Results - For:
      = doc.elements["testsuite"].attribute("name")
    :css
      .test-failure a.test-status {
          color: red;
      }
      .test-error a.test-status {
          color: red;
      }
      .test-passed p.test-status {
          color: green;
      }
      .test-skipped a.test-status {
          color: blue;
      }
      a.test-status {
          text-transform: capitalize;
      }
      p.test-status {
          text-transform: capitalize;
      }
      pre.test-status {
          display: none;
          white-space: pre-wrap;
      }
    = javascript_include_tag 'jquery.min'
    :javascript
      $(document).ready(function() {
          $("a.test-status").click(function() {
              $(this).next("pre").toggle();
              return false;
          });
      });
  %body
    %h3.divided
      Results for
      = doc.elements["testsuite"].attribute("name")
    .testcases
      - tests = doc.elements.to_a('testsuite/testcase').group_by{|el| el.attribute("classname").to_s()}
      - tests.keys.sort.each do |class_name|
        %h3= class_name
        %table{:border => "1"}
          %thead
            %tr
              %td Test name
              %td Running time
              %td State
          %tbody
            - tests[class_name].each do |test_run|
              - if not test_run.has_elements?
                - type = "passed"
              - else
                - type = test_run.elements[1].name
              %tr{:class => "test-"+type}
                %td
                  %p= test_run.attribute("name").to_s()
                %td
                  %p= test_run.attribute("time").to_s()
                %td
                  - if type == "passed"
                    %p{:class => "test-status"}= type
                  - else
                    %a{:class => "test-status", :href => "javascript:void(0)"}= type
                    %pre{:class => "test-status"}= test_run.elements[1].cdatas()
